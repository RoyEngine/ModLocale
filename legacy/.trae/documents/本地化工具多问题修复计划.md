# 本地化工具多问题修复计划

## 1. 调整应用界面布局

**问题**：交换"Decompile"模式和"File Management"模式的位置，将Decompile模式调整到第3位，File Management模式调整到第4位

**修复方案**：
- 修改主菜单显示顺序，将Decompile模式和File Management模式交换位置
- 保持功能实现不变，仅调整界面显示顺序
- 确保功能说明文字与实际功能匹配

**实现步骤**：
1. 修改 `select_main_mode` 函数中的打印语句顺序
2. 更新选择逻辑中的数字对应关系
3. 验证功能顺序调整后的用户体验

## 2. 实现一致的导航结构

**问题**：为每个选择屏幕添加"Return to Previous Menu"选项

**修复方案**：
- 为所有选择函数添加返回上一级菜单的选项
- 统一使用数字0作为返回选项，位置固定在菜单底部
- 确保所有选择循环中包含返回逻辑，返回值使用特殊标记
- 保持所有选择屏幕的视觉一致性

**实现步骤**：
1. 修改 `select_main_mode` 函数，添加返回选项
2. 修改 `select_extract_sub_flow` 函数，添加返回选项
3. 修改 `select_extend_sub_flow` 函数，添加返回选项
4. 修改 `select_decompile_sub_flow` 函数，添加返回选项
5. 修改 `select_file_management_sub_flow` 函数，添加返回选项
6. 确保所有选择循环中正确处理返回选项
7. 统一返回选项的显示格式

## 3. 处理残留路径问题

**问题**：修复终端中显示的无效规则路径，确保所有路径正确指向 `File/rule` 目录结构

**修复方案**：
- 查找并替换所有旧路径引用
- 确保所有路径映射正确指向 `File/rule` 目录结构
- 使用配置管理器动态获取正确路径

**实现步骤**：
1. 修复 `extend_mode/core.py` 中的旧路径引用
2. 修复 `common/file_utils.py` 中的旧路径引用
3. 确保所有路径使用配置管理器获取
4. 验证路径解析逻辑正确
5. 测试路径访问功能

## 4. 修复数据提取问题

**问题**：`English_mappings.json` 中 mod_info.json 内容未被正确插入到指定字段

**修复方案**：
- 检查 JSON 解析逻辑
- 修复目标字段映射
- 实现数据插入验证

**实现步骤**：
1. 检查 `extract_mode/core.py` 中的 JSON 生成逻辑
2. 确保 `mod_info.json` 数据正确提取
3. 修复 `English_mappings.json` 中字段映射
4. 实现数据验证机制
5. 添加错误处理和日志记录
6. 测试数据提取和插入功能

## 5. 解决错误重命名问题

**问题**：`source` 和 `source_backup` 目录下的 "Chinese" 和 "English" 文件夹被错误重命名

**修复方案**：
- 修改 `rename_mod_folders` 函数，添加保护机制
- 确保不重命名固定的 "Chinese" 和 "English" 语言文件夹
- 修复重命名逻辑

**实现步骤**：
1. 修改 `rename_mod_folders` 函数，添加对语言文件夹的检查
2. 在重命名逻辑中跳过 "Chinese" 和 "English" 文件夹
3. 修复文件夹遍历逻辑，确保正确处理嵌套目录
4. 添加日志记录，便于调试
5. 测试文件夹重命名功能，确保语言文件夹不再被错误重命名

## 实施顺序

1. 首先修复错误重命名问题，防止进一步破坏文件夹结构
2. 处理残留路径问题，确保系统使用正确的路径
3. 调整应用界面布局，提升用户体验
4. 实现一致的导航结构，增强用户操作便捷性
5. 修复数据提取问题，确保数据完整性

## 验证方法

1. 手动测试所有菜单选项，确保界面布局调整正确
2. 测试所有返回上一级菜单功能，确保导航一致
3. 检查文件路径日志，确保旧路径不再出现
4. 验证 `English_mappings.json` 中的数据提取和插入
5. 测试文件夹重命名功能，确保语言文件夹不再被错误重命名
6. 运行完整的工具流程，确保所有功能正常工作

通过以上修复，确保本地化工具的界面、导航、路径处理、数据提取和文件管理功能都能正常工作，提升整体用户体验和功能可靠性。